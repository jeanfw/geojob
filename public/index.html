
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Proche Emploi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="/img/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="/img/ico/favicon.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Proche Emploi !</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <!--
<li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
-->
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <h2>Trouvez un emploi facilement accessible en transports en commun !</h2>
      <p>Proche Emploi permet de chercher les offres d'emploi en fonction du temps qu'il vous faudra pour vous y rendre.</p>
      
      <form class="form-horizontal">
      </form>
      
      <form class="form-horizontal" id="search_form">
        <div class="control-group">
          <label class="control-label" for="postal_code">Code postal de votre domicile</label>
          <div class="controls">
            <input type="text" id="postal_code" name="postal_code" placeholder="75001" value="75001"><span class="help-inline" id="home_postal_code_lambert"></span>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="search_query">Poste recherch√©</label>
          <div class="controls">
            <input type="text" id="search_query" class="" placeholder="vendeur" value="commercial">
          </div>
        </div>
        <div class="form-actions">
            <button class="btn btn-primary" type="submit">Trouvez-moi un emploi !</button>
        </div>
      </form>
      
      <ul class="thumbnails" id="search_results">
      </ul>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="http://twitter.github.com/hogan.js/builds/2.0.0/hogan-2.0.0.js"></script>

    <script src="/js/conversion.js"></script>
    <script src="/js/geojob.js"></script>
    
    <!-- API libraries should go here -->
    <script src="/js/zijob.js"></script>
    <script src="/js/sncf.js"></script>
    
    <script id="job_template" type="text/x-handlebars-template">
        <li class="span4">
          <div class="thumbnail">
            <p align="center" style="">
              <img src="{{company.logo.small}}" alt="" style="margin: auto;">
            </p>
            <h4>{{title}}</h4>
            <p>{{category.value}}</p>
            <address>
              {{location.address}}<br>
              {{location.postal_code}} {{location.city}}
            </address>
            <p>Temps de trajet: {{time}}</p>
            <p>Type de trajet: {{transport_type}}</p>
            <p>Lat/Lng: ({{lat}}, {{lng}})</p>
            <p>Lambert X/Y: ({{x}}, {{y}})</p>
            <p>
              <ul>
                {{#stations}}
                <li>{{stop_point.StopPointName}} - {{stop_point.Mode.ModeName}} - {{stop_point.Mode.ModeName}} ({{distance}}m)</li>
                {{/stations}}
              </ul>
            </p>
          </div>
        </li>
    </script>

    
    <!-- Core script -->
    
    <script type="text/javascript">
    
      // construct template string
      var template = "Hello {{world}}!";
      
      // compile template
      var job_template = Hogan.compile($("#job_template").html());

    
      $(document).ready(function() {
        $("#search_form").submit(function(e) {
          
          // Prevent form submission
          e.preventDefault();
          
          // Test geoencoding
          
          // console.log($("#postal_code").val());
          
          getLamb2($("#postal_code").val(), function(home_coords) {
          
            // console.log(home_coords);
                    
            $('#home_postal_code_lambert')
            .html(home_coords.x + "; " + home_coords.y);
            
            zijobKeywordSearch($("#search_query").val(), function(err, jobs) {
              if (err) console.error(err);
              else {
              
                $('#search_results').html('');
                jobs.forEach(function(job) {
                
                  getLamb2(job.location.postal_code, function(job_coords) {
                    // console.log(job_coords);
                    
                    job = $.extend(job, job_coords);
                    
                    sncfNearbyStations(job.x, job.y, function(err, stations) {
                    
                      console.log(stations);
                      
                      job.stations = stations;
                      
                      $('#search_results')
                      .append(job_template.render(job));
                      
                    });
                    
                  });
                  
                })
              }
            })
            
          });
          
        })
      });
    
    </script>
    
    <!-- /Core script -->
    
  </body>
</html>
